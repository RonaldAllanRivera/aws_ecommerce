# AWS E-commerce Microservices (Laravel 12 + Vue 3)

A production-style, cloud-ready e-commerce platform featuring microservice architecture, SPA frontend, asynchronous messaging, and infrastructure-as-code deployment.

The system is built from three Laravel 12 microservices (Catalog, Checkout, Email) and a Vue 3 SPA frontend, all containerized with Docker and designed to run on a single AWS EC2 instance with infrastructure managed via AWS CloudFormation.

---

## 1. Features & Goals

- **Microservices**
  - **Catalog**: product catalog, categories, inventory, public product APIs, admin product management.
  - **Checkout**: shopping cart, order placement, basic payment handling, order administration.
  - **Email**: asynchronous order confirmation emails with logging.
- **Frontend**
  - Vue 3 SPA for all public pages: browsing products, cart, checkout, order confirmation.
- **Admin**
  - Filament 4-based admin panels for Catalog and Checkout services.
  - Seeded super admin users per service via environment-driven seeders.
- **Data & Infra**
  - MySQL database (per-service schemas) running in Docker.
  - SQS for `OrderCreated` events, SES for outbound email.
  - Single Free Tier-eligible EC2 instance running all containers.
- **Non-functional**
  - Clear separation of concerns by service.
  - Free-tier friendly AWS usage.
  - Room to demonstrate advanced SQL tuning and optional Elasticsearch/OpenSearch-based catalog search.

---

## 2. Architecture Overview

### 2.1 Services

- **Catalog service (Laravel 12)**
  - Owns product, category, inventory, product images.
  - Exposes read-only product APIs for the SPA and Checkout service.
  - Filament 4 admin panel for managing catalog data.

- **Checkout service (Laravel 12)**
  - Owns carts, orders, order items, payments.
  - Integrates with Catalog for price/stock validation.
  - Publishes `OrderCreated` events to SQS.
  - Filament 4 admin panel for orders and basic reporting.

- **Email service (Laravel 12)**
  - Consumes SQS `order-events` messages.
  - Renders order confirmation emails and sends via SES.
  - Logs email sending attempts/results.

### 2.2 Frontend

- **Vue 3 + Vite SPA**
  - Public pages: home, product list, product detail, cart, checkout, order confirmation.
  - Uses Axios to call Catalog and Checkout APIs.
  - Uses Pinia for catalog and cart state (planned in later phases).

### 2.3 Data & Infrastructure

- **Databases** (MySQL in Docker on EC2)
  - `catalog_db`, `checkout_db`, `email_db` (logical schemas).
  - Database-per-service access via separate connections.

- **Messaging & Email**
  - SQS queue `order-events` for order creation events.
  - SES for outbound order confirmation emails.

- **Compute & Network**
  - Single EC2 instance (Free Tier-eligible) running Docker.
  - Nginx in Docker as reverse proxy for APIs and SPA.

---

## 3. Tech Stack

- **Backend**: PHP 8.x, Laravel 12, Filament 4, Livewire.
- **Frontend**: Vue 3, Vite, TypeScript (optional), Pinia, Axios.
- **Database**: MySQL (containerized), SQLite for quick local bootstrapping.
- **Messaging & Email**: AWS SQS, AWS SES.
- **Infra**: Docker, Docker Compose, AWS EC2, AWS CloudFormation, AWS SSM Parameter Store.
- **Tooling**: Composer, Node.js + npm, GitHub Actions (planned).

---

## 4. Repository Layout

```text
aws_ecommerce/
├─ PLAN.md                 # Detailed architecture and implementation plan
├─ README.md               # This file
├─ docker-compose.yml      # (Phase 2) Local dev stack
├─ infra/
│  └─ cloudformation/      # (Planned) AWS infrastructure templates
├─ services/
│  ├─ catalog/             # Laravel 12 app – Catalog microservice
│  ├─ checkout/            # Laravel 12 app – Checkout microservice
│  └─ email/               # Laravel 12 app – Email microservice
├─ frontend/               # Vue 3 + Vite SPA
└─ .github/workflows/      # (Planned) CI/CD pipelines
```

Refer to `PLAN.md` for a more detailed breakdown of responsibilities and APIs.

---

## 5. Getting Started (Local, pre-Docker)

This section describes a simple local setup useful while Docker and AWS infrastructure are still being implemented. Each Laravel service currently uses SQLite by default.

### 5.1 Prerequisites

- PHP 8.2+ with required extensions for Laravel.
- Composer
- Node.js 18+ and npm
- Git
- (Later) Docker and Docker Compose

### 5.2 Clone and install dependencies

```bash
git clone <your-repo-url> aws_ecommerce
cd aws_ecommerce
```

Install PHP dependencies for each microservice:

```bash
cd services/catalog
composer install

cd ../checkout
composer install

cd ../email
composer install
```

Install frontend dependencies:

```bash
cd ../../frontend
npm install
```

### 5.3 Environment configuration (current local setup)

Each Laravel service ships with a default `.env` generated by `composer create-project` and using SQLite. For quick local testing you can keep SQLite and run migrations.

Example (Catalog):

```dotenv
DB_CONNECTION=sqlite
QUEUE_CONNECTION=database
SESSION_DRIVER=database
```

The Catalog and Checkout services also define the following environment variables for Filament admin seeding:

- Catalog `.env`:

  ```dotenv
  FILAMENT_ADMIN_EMAIL="jaeron.rivera@gmail.com"
  FILAMENT_ADMIN_PASSWORD="123456789"
  ```

- Checkout `.env`:

  ```dotenv
  FILAMENT_ADMIN_EMAIL="jaeron_rivera@yahoo.com"
  FILAMENT_ADMIN_PASSWORD="123456789"
  ```

Later, Phase 2 will switch all services to use the shared MySQL container and service-specific schemas.

### 5.4 Run migrations and seed admins (optional early check)

If you want to verify Filament login using SQLite before Docker is in place:

```bash
# Catalog
cd services/catalog
php artisan migrate --seed

# Checkout
cd ../checkout
php artisan migrate --seed
```

This uses `FilamentAdminUserSeeder` to create or update an admin user with the configured email and password.

### 5.5 Run services locally (without Docker)

For early development you can use Laravel's built-in server and Vite:

- Catalog:

  ```bash
  cd services/catalog
  php artisan serve --port=8001
  ```

- Checkout:

  ```bash
  cd services/checkout
  php artisan serve --port=8002
  ```

- Email (if you expose HTTP routes):

  ```bash
  cd services/email
  php artisan serve --port=8003
  ```

- Frontend:

  ```bash
  cd frontend
  npm run dev
  ```

You can then point the Vue app's API base URLs to these local ports during early development.

---

## 6. Filament Admin Access

Both Catalog and Checkout services use Filament 4 for admin UIs.

### 6.1 Admin seeding

Each service has a `FilamentAdminUserSeeder` that reads credentials from `.env`:

- `FILAMENT_ADMIN_EMAIL`
- `FILAMENT_ADMIN_PASSWORD`

Running `php artisan db:seed` will create or update the admin user accordingly.

### 6.2 Default credentials (development only)

- **Catalog admin**
  - Email: `jaeron.rivera@gmail.com`
  - Password: `123456789`

- **Checkout admin**
  - Email: `jaeron_rivera@yahoo.com`
  - Password: `123456789`

These are for local development only and must be changed for any shared or deployed environment.

Filament's default panel path is `/admin` per service. In the Docker-based local environment, the Catalog admin panel is available at `http://catalog.localhost:8080/admin` and the Checkout admin panel is available at `http://checkout.localhost:8080/admin`.

---

## 7. Phase 2: Docker-Based Local Environment (Completed)

Phase 2 defines a Docker-based local environment closely mirroring the AWS deployment:

- `docker-compose.yml` with services for:
  - `mysql` (shared instance with `catalog_db`, `checkout_db`, `email_db`).
  - `redis` (cache and queues).
  - `mailhog` (local email testing).
  - `catalog-app`, `checkout-app`, `email-app` (PHP-FPM Laravel containers).
  - `nginx` (reverse proxy for APIs and SPA).
- Dockerfiles for Laravel services and Nginx.
- Updated `.env` for each service to use the MySQL container and appropriate DB credentials.

With Phase 2 completed, the recommended local workflow is:

```bash
docker compose up --build
```

and all services will be reachable via Nginx on a single host/port.

### 7.1 Running the full stack with Docker

From the project root:

```bash
docker compose up --build
```

This will:

- Start MySQL and initialize `catalog_db`, `checkout_db`, and `email_db` (plus users) using the SQL script in `docker/mysql/init/`.
- Start Redis and Mailhog.
- Build and run the three Laravel PHP-FPM containers.
- Start Nginx on `http://localhost:8080`.

Once the stack is running, the main local endpoints are:

- Catalog service
  - App: `http://catalog.localhost:8080/catalog/`
  - Health: `http://catalog.localhost:8080/catalog/health`
- Checkout service
  - App: `http://checkout.localhost:8080/checkout/`
  - Health: `http://checkout.localhost:8080/checkout/health`
- Email service
  - App: `http://localhost:8080/email/`
  - Health: `http://localhost:8080/email/health`
- Mailhog UI
  - `http://localhost:8025`

### 7.2 Running migrations and seeders against MySQL

After the containers are up, run the migrations and seeders **inside** the app containers:

```bash
# Catalog service (includes Filament admin seeder)
docker compose exec catalog-app php artisan migrate --seed

# Checkout service (includes Filament admin seeder)
docker compose exec checkout-app php artisan migrate --seed

# Email service
docker compose exec email-app php artisan migrate
```

These commands apply the schema to the MySQL databases defined in `docker/mysql/init/01-init-databases.sql` and create the default Filament admin users using the `.env` credentials.

### 7.3 Catalog APIs (Phase 3 – completed)

As part of Phase 3, the Catalog service exposes JSON APIs via Nginx:

- List products (paginated, with filters):
  - `GET /catalog/api/products`
  - Query params: `search`, `category`, `min_price`, `max_price`, `sort`, `per_page`
  - On MySQL, `search` uses a FULLTEXT index on `name` and `description` (with relevance ordering by default)
- Product detail (by slug):
  - `GET /catalog/api/products/{slug}`
- List categories:
  - `GET /catalog/api/categories`

The Catalog database is seeded with sample categories and products (including placeholder images) via `CatalogSampleDataSeeder`.

**Admin panel (Catalog)**

- URL (Docker, local): `http://localhost:8080/catalog/admin`
- Guard: default `web` guard with Filament 4
- Credentials: same as the Catalog admin in section 6.2

### 7.4 Checkout APIs (Phase 4 – backend APIs completed)

As part of Phase 4, the Checkout service exposes JSON APIs via Nginx:

- Cart endpoints:
  - `POST /checkout/api/cart` – create or reuse an open cart based on a `cart_token`.
  - `GET /checkout/api/cart` – retrieve the current cart by `cart_token`.
  - `POST /checkout/api/cart/items` – add an item to the cart by `product_sku`.
  - `PUT /checkout/api/cart/items/{id}` – update a cart item's quantity.
  - `DELETE /checkout/api/cart/items/{id}` – remove a cart item.
- Checkout endpoints:
  - `POST /checkout/api/place-order` – create an order and payment from the current cart.
  - `GET /checkout/api/orders/{orderNumber}` – retrieve an order summary and payment details.

Cart items and orders use canonical pricing and product names resolved from the Catalog service via SKU-based lookups, and snapshot these values into `CartItem` and `OrderItem` records. The `place-order` endpoint revalidates prices and available stock against the Catalog service before creating an order and payment, and on success dispatches an `OrderCreated` message to the logical `order-events` queue for the Email service to consume. In the Docker-based local environment, Checkout uses Laravel's `sync` queue driver and logs to stderr so you can see `OrderCreated` activity directly in container logs; in AWS this will be switched to SQS (and CloudWatch or file-based logging) via environment configuration.

**Admin panel (Checkout)**

- URL (Docker, local): `http://checkout.localhost:8080/checkout/admin`
- Filament 4 resources for Orders and Payments with list views, filters, infolist-based detail views (including order items and payment info), and delete actions (row, bulk, and view header).

---

## 8. AWS Deployment (High Level)

AWS deployment is designed to stay within the AWS Free Tier:

- **Compute**: single Free Tier-eligible EC2 instance (Docker host).
- **Database**: MySQL in Docker on EC2.
- **Messaging**: SQS queue `order-events`.
- **Email**: SES for order confirmation emails.
- **Config/Secrets**: SSM Parameter Store for DB credentials, app keys, and other configuration.
- **Infrastructure as Code**: CloudFormation templates under `infra/cloudformation/` (networking, EC2 + Docker, SQS, IAM roles and permissions).

Deployment flow (once templates are in place):

1. Build and push Docker images (or build directly on EC2).
2. Deploy/update CloudFormation stacks for networking and compute.
3. Deploy/update application stack (SQS, IAM, SES-related config).
4. Start Docker Compose on the EC2 instance.

Details are described more thoroughly in `PLAN.md` and will be refined as implementation progresses.

---

## 9. Testing Strategy

Planned testing approach:

- **Backend (each Laravel service)**
  - Unit tests for core domain logic (pricing, inventory checks, order creation, email triggers).
  - Feature tests for key endpoints (cart flow, place order, email dispatch via queue).

- **Frontend (Vue)**
  - Component tests (e.g. Vitest) for cart, product list, and checkout components.
  - End-to-end tests (e.g. Playwright or Cypress) for full checkout flow.

- **CI (GitHub Actions)**
  - Run PHP tests, linting, and frontend tests on pull requests.
  - On main branch, build Docker images and (optionally) trigger CloudFormation updates.

---

## 10. Roadmap / Implementation Phases

Implementation is tracked in `PLAN.md`. High-level phases:

1. **Bootstrap & base stack**
   - Git repo, three Laravel 12 services, Filament 4 installation, Vue 3 + Vite SPA scaffold, Filament admin seeders.
2. **Local Docker environment**
   - Dockerfiles, docker-compose.yml, MySQL/Redis/Mailhog, Nginx reverse proxy.
3. **Service features**
  - Catalog: products, categories, inventory, search, API tests.
   - Checkout: cart, orders, SQS event publishing.
   - Email: SQS consumption, SES integration, logging.
4. **Frontend integration**
   - Vue SPA calling Catalog and Checkout services, handling cart state and checkout.
5. **AWS infrastructure & deployment**
   - CloudFormation stacks, EC2 + Docker host, SQS, SES, SSM integration.
6. **Hardening & advanced topics**
   - Advanced SQL and MySQL performance tuning.
   - Optional Elasticsearch/OpenSearch-based catalog search.
   - Monitoring, logging, and CI/CD.

This README focuses on the current state and the roadmap so that reviewers can understand both what is implemented and what is planned next.
